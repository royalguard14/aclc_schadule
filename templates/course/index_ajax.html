{% extends "layouts/master.html" %}
{% block crump1 %}COURSE{% endblock %}
{% block crump2 %}course{% endblock %}
{% block head %}
{% endblock %}
{% block content %}








<div class="row" id="relodes">
  <div class="col-lg-4" >
    <div class="card">
      <div class="card-header border-0">
        <div class="d-flex justify-content-between">
          <h3 class="card-title">Add New Course</h3>
        </div>
      </div>
      <div class="card-body">
        <form id="addForm">
          <div class="card-body">
            <div class="form-group">
              <label for="exampleInputPassword1">Department</label>
              <select id="select_dept" class="form-control select2bs4" name="dept_id">
              </select>
            </div> 
            <div class="form-group">
              <label for="exampleInputEmail1">Course Name</label>
              <input type="text" name="course_name" id="course_name" class="form-control" required>
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Course Code</label>
              <input type="text" name="course_code" id="course_code" class="form-control" required>
            </div>
          </div>
          <!-- /.card-body -->
          <button type="submit" class="btn btn-primary float-right" id="save-button">Submit</button>
        </form>
      </div>
    </div>
    <!-- /.card -->
  </div>
  <!-- /.col-md-6 -->

  <div class="col-lg-8">
    <div class="card">
      <div class="card-header border-0">
        <div class="d-flex justify-content-between">
          <h3 class="card-title">Department List</h3>
          <a href="javascript:void(0);">View Report</a>
        </div>
      </div>
      <div class="card-body">
        <table id="excel_tablesa" class="table table-bordered table-striped">
          <thead>
            <tr>
              <th>#</th>
              <th>Department</th>
              <th>Course</th>
              <th>Code</th>
              <th>Action</th>
            </tr>
          </thead>

        </table>
      </div>
    </div>
    <!-- /.card -->
  </div>
  <!-- /.col-md-6 -->
</div>
<!-- /.row -->
<!-- Modal -->
<div class="modal fade" id="modal-sm">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">EDIT Course</h4>
      </div>
      <div class="modal-body">
        <form action="" id="edit-form">
          <div class="form-group">
            <label for="exampleInputEmail1">Department Name</label>
             <select id="edit_select_dept" class="form-control select2bs4">
            </select>
            <input type="text" name="sid" id="edit-id" hidden="">
          </div>
                    <div class="form-group">
            <label for="exampleInputPassword1">Course Name</label>
            <input type="text" name="department_acronym" id="edit_course_name" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="exampleInputPassword1">Course Code</label>
            <input type="text" name="department_acronym" id="edit_course_code" class="form-control" required>
          </div>
        </form>
      </div>
      <div class="modal-footer justify-content-between">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="edit-submit">Save changes</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
{% endblock %}
{% block script %}
<script type="text/javascript">
 function awits(){


    var t = $('#excel_tablesa').DataTable();
      $.ajax({
        url : "{{ url_for('courses.course_show')}}",
        type : "GET",
        success : function(data){
            var len = data.length; 
          if(len > 0){
            for(var i=0; i<len; i++){
              console.log(data[i])
  t.row.add( [data[i]['no'],data[i]['dept_id'],data[i]['course_name'],data[i]['course_acronym'],'action here']).draw();
  
            }
          }
          
        }
      });
  }


    // load data---------------------------------------------
    function loaddatas(){
      $.ajax({
        url : "{{ url_for('departments.dept_show')}}",
        type : "GET",
        success : function(data){
          $("#select_dept").empty();
          var option1 = "<option selected="+"selected" + ">Select Department</option>"; 
          $("#select_dept").append(option1); 
          var len = data.length; 
          if(len > 0){
            for(var i=0; i<len; i++){
              var option = "<option value='"+data[i][0]+"'>"+data[i][1]+"</option>"; 
              $("#select_dept").append(option);   
            }
          }
        }
      });
    }

  function loaddatas2(x){
      $.ajax({
        url : "{{ url_for('departments.dept_show')}}",
        type : "GET",
        success : function(data){
      
          $("#edit_select_dept").empty();
     
          var option1 = "<option>Select Department</option>"; 

          $("#edit_select_dept").append(option1); 
          var len = data.length; 
          if(len > 0){
            for(var i=0; i<len; i++){
              if (data[i][0] == x){
                 var option = "<option value='"+data[i][0]+"' selected>"+data[i][1]+"</option>"; 
              }else{
                 var option = "<option value='"+data[i][0]+"'>"+data[i][1]+"</option>"; 
              }
              $("#edit_select_dept").append(option);   
            }
          }
        }
      });
    }



    $('#save-button').on("click",function(e){
      e.preventDefault();
      var course_name = $('#course_name').val();
      var course_code = $('#course_code').val();
      var dept_id = $('#select_dept').val();
      if ( course_name == "" || course_code == "" || dept_id == "Select Department") {
        switalert('warning', 'All fields are required !');
      }
      else{
        $.ajax({
          url : "{{ url_for('courses.course_store')}}",
          type : "POST",
          data : JSON.stringify({course_name : course_name, course_code : course_code, dept_id : dept_id}),
          dataType : "json",
          contentType : "application/json; charset=utf-8",
          success : function(data){
            if (data == 1) {
              $("#excel_tablesa").html('');
              awits();
              document.getElementById("addForm").reset();
              loaddatas()
              stoast('Data has been Saved  !', 'success');
            }else{
              switalert('error', "Can't Save Record.");
            }
          }
        });
      }
    });


        // update data---------------------------------------------
        $(document).on("click","#edit", function(e){

          $('#modal-sm').modal('toggle');
          var id = $(this).data("id");
          var dept = $(this).data("dept");
          var subj = $(this).data("subj");
          var code = $(this).data("code");
          loaddatas2(dept);
          $('#edit-id').val(id);
          $('#edit_course_name').val(subj);
          $('#edit_course_code').val(code);
        });


        //Update Record------------------------------------------
        $(document).on("click", "#edit-submit", function(e){
          e.preventDefault();
          var id =  $('#edit-id').val();
          var dept = $('#edit_select_dept').val();
          var subj = $('#edit_course_name').val();
          var code = $('#edit_course_code').val();
          if (dept == "Select Department" || subj == "" || code == "") {
            switalert('warning', 'All fields are required !');
          }else {
            $.ajax({
              url : "{{ url_for('courses.course_update')}}",
              type : "POST",
              data : JSON.stringify({id : id, dept : dept, subj : subj, code : code}),
              dataType : "json",
              contentType : "application/json; charset=utf-8",
              success : function(data){
                if (data == 1) {
                  $('#modal-sm').modal('hide');
                  stoast('Data has been Updated  !', 'info');
                }else{
                  switalert('error', "Can't Save Record.");
                }
              }
            });
          }
        });


 // delete data---------------------------------------------
        $(document).on("click","#delete", function(e){
          Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
          }).then((result) => {
            if (result.isConfirmed) {
              var course_id = $(this).data("id");
              $.ajax({
                url : "{{ url_for('courses.course_destroy')}}",
                type : "POST",
                data : JSON.stringify({id : course_id}),
                dataType : "json",
                contentType : "application/json; charset=utf-8",
                success : function(data){
                  if (data == 1){
                    get_dept();
                    Swal.fire(
                    'Deleted!',
                    'Your file has been deleted.',
                    'success'
                    )
                  }else{
                    switalert('error', "Can't Delete Record.");
                  }
                }
              });
            }
          })
        });





    loaddatas();
    awits();
  </script>



  {% endblock %}